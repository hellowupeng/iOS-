## Implementing a Container View Controller

实现一个容器视图控制器。

容器视图控制器是一种从多个视图控制器结合内容到单个用户界面的方式。容器视图控制器最常用于促进导航和创建新的基于存在的内容的用户界面类型。UIKit里的容器视图控制器例子包括UINavigationController，UITabBarController和UISplitViewController，所有的这些在不同的用户界面之间促进导航。

###### 设计一个自定义的容器视图控制器

在几乎每种方式里，容器视图控制器像其他任何内容视图控制器一样管理一个根视图和一些内容。差别是容器视图控制器从其他视图控制器取得部分内容。它获取的内容受限于嵌入到它自己的视图层次结构里的其他视图控制器的视图。容器视图控制器设置嵌入的视图的大小和位置，但是原来的视图控制器仍然管理这些视图里的内容。

在设计你自己的容器视图控制器时，总是理解容器和包含的视图控制器之间的关系。视图控制器的关系可以帮助通知他们的内容应该如何在屏幕上出现和你的容器如何在内部管理他们。在设计过程期间，询问你自己以下问题：

- 容器的角色是什么和它的子视图控制器们扮演什么角色？
- 多少子视图控制器同时显示？
- 兄弟视图控制器之间的关系是什么？
- 子视图控制器们如何从容器添加或移除？
- 子视图控制器的大小和位置能变化吗？这些变化在什么条件下发生？
- 容器提供任何它自己的装饰性的或导航相关的视图吗？
- 容器和它的子视图控制器之间要求的通信种类是什么？除了UIViewController类定义的标准事件外容器需要报告特定的事件给它的子视图控制器吗？
- 容器的外观能用不同的方式配置吗？如果可以，怎样做？

在你已经定义了各种各样的对象的角色后，容器视图控制器的实现是相当简单的。来自UIKit的唯一要求是在容器视图控制器和子视图控制器之间建立一种正式的父子关系。父子关系确保子视图控制器接收任何有关的系统消息。除此之外，大多数实际工作在包含的视图的布局和管理期间发生，对于每个容器都不同。你可以在容器的内容区域的任何地方放置视图并无论以你想要的任何方式调整这些视图。你也可以添加自定义视图到视图层次结构来在导航里提供装饰或辅助。

**示例：导航控制器**

UINavigationController对象支持通过一个层级数据集导航。一个导航界面一次展示一个子视图控制器。界面顶部的导航栏显示在数据层级里的当前位置并显示一个返回按钮来回退一级。进入数据层级的导航是左边的到子视图控制器并能影响表和按钮的使用。

视图控制器之间的导航由导航控制器和它的子视图控制器们共同管理。在用户和按钮或子视图控制器和表视图行交互时，子视图控制器要求导航控制器推一个新的视图控制器到视图。子视图控制器处理新的视图控制器的内容的配置，但是导航控制器管理过渡动画。导航控制器也管理显示一个返回按钮用于清除最高的视图控制器的导航栏。

图5-1显示了导航控制器和它的视图的结构。大多数内容区域由最高的子视图控制器填满，只有小部分由导航栏占用。

![VCPG_structure-of-navigation-interface_5-1_2x](/Users/andywu/Documents/iOS-daily-questions/View Controller Programming Guide for iOS/images/VCPG_structure-of-navigation-interface_5-1_2x.png)

在紧凑和正常环境里，导航控制器一次只显示一个子视图控制器。导航控制器改变它的子视图控制器的大小来适应可用的空间。

**示例：拆分视图控制器**

拆分视图控制器在一个主-从安排里显示两个视图控制器的内容。在这个安排里，一个视图控制器（主视图控制器）决定其他视图控制器显示什么详情。两个视图控制器的可见性是可配置的但是也是由当前环境决定的。在正常水平水平的环境里，拆分视图控制器能并排显示两个子视图控制器或者如果需要它能隐藏主视图控制器并显示它。在紧凑环境里，拆分视图控制器一次只显示一个视图控制器。

图5-2显示了在正常水平环境里拆分视图界面和它的视图的结构。拆分视图控制器默认只有它自己的容器视图。在这个例子里，两个子视图并排显示。子视图的大小和主视图的可见性一样是可配置的。

![VCPG-split-view-inerface_5-2_2x](/Users/andywu/Documents/iOS-daily-questions/View Controller Programming Guide for iOS/images/VCPG-split-view-inerface_5-2_2x.png)

###### 在界面构建器里配置容器

为了在设计时创建一个父子容器关系，添加一个容器视图对象到你的故事板场景，如图5-3所示。容器视图对象是一个代表子视图控制器内容的占位对象。使用那个视图来调整和安置容器里其他视图们关联的子视图控制器的根视图。

![container_view_embed_2x](/Users/andywu/Documents/iOS-daily-questions/View Controller Programming Guide for iOS/images/container_view_embed_2x.png)

在你用一个或多个容器视图加载一个视图控制器时，界面构建器也加载与这些视图关联的子视图控制器。子视图控制器必须和父视图控制器同时实例化，以便合适的父子关系能被创建。

如果你不使用界面构建器来设置你的父子容器关系，你必须通过编程添加每个子视图控制器到容器视图控制器创建这些关系，在Adding a Child View Controller to Your Content里描述。

###### 实现一个自定义的容器视图控制器

为了实现一个容器视图控制器，你必须在视图控制器和它的子视图控制器之间建立关系。在你尝试管理子视图控制器的视图之前建立这些父-子关系是必要的。这样做让UIKit知道你的视图控制器正在管理子视图控制器的大小和位置。你可以在界面构建器里创建这些关系或者通过编程创建它们。在通过编程创建父-子关系时，显示地添加和移除子视图控制器作为你的视图控制器设置的一部分。

**添加子视图控制器到内容**

为了通过编程合并子视图控制器到你的内容，通过做以下事情来在有关的视图控制器之间创建一种父-子关系。

1. 调用容器视图控制器的`addChildViewController:`方法。

   这个方法告诉UIKit你的容器视图控制器现在管理子视图控制器的视图。

2. 添加子视图控制器的根视图到容器的视图层次结构。

   总是记住设置子视图的frame的大小和位置作为这个过程的一部分。

3. 为管理子视图控制器的根视图大小和位置添加约束。

4. 调用子视图控制器的`didMoveToParentViewController:`方法。

清单5-1展示了一个容器如何在它的容器里嵌入一个子视图控制器。在建立父-子关系后，容器容器设置子视图的frame并添加子视图控制器的视图到它自己的视图层次结构。

设置子视图控制器的视图的frame size是重要的并且确保视图在容器里正确地显示。在添加视图后，容器调用子视图控制器的`didMoveToParentViewController:`方法来给子视图控制器一个机会响应视图所有权的改变。

```objective-c
- (void)displayContentController: (UIViewController *)content {
    [self addChildViewController: content];
    content.view.frame = [self frameForContentController];
    [self.view addSubview: self.currentClientView];
    [content didMoveToParentViewController: self];
}
```

**移除子视图控制器**

**在子视图控制器之间过渡**

**为子视图控制器们管理外观更新**

###### 构建一个容器视图控制器的建议

###### 委托控制给子视图控制器